"use strict";var WPFormsFormTemplates=window.WPFormsFormTemplates||function(e,w){var g={},h={init:function(){w(h.ready),w(e).on("load",function(){"function"==typeof w.ready.then?w.ready.then(h.load):h.load()})},ready:function(){h.setup(),h.events()},load:function(){h.showUpgradeBanner()},setup:function(){g.templateList=new List("wpforms-setup-templates-list",{valueNames:["wpforms-template-name","wpforms-template-desc",{name:"slug",attr:"data-slug"},{name:"categories",attr:"data-categories"},{name:"subcategories",attr:"data-subcategories"},{name:"has-access",attr:"data-has-access"},{name:"favorite",attr:"data-favorite"}]})},events:function(){w("#wpforms-setup-templates-list").on("click",".wpforms-template-favorite i",h.selectFavorite)},selectFavorite:function(e){function t(){u.favorite=!1,p-=1,d.values(u),v(),l.data("data-favorite",0),c.html(p),h.maybeHideFavoritesCategory()}function a(){u.favorite=!0,p+=1,d.values(u),v(),l.data("data-favorite",1),c.html(p),h.maybeHideFavoritesCategory()}let s=w(this),o=s.hasClass("fa-heart-o"),n=s.closest(".wpforms-template-favorite"),r=s.closest(".wpforms-template"),l=r.find(".wpforms-template-name"),i=r.find(".wpforms-template-select").data("slug"),m=w(".wpforms-setup-templates-categories").find("[data-category='favorites']"),c=m.find("span"),p=parseInt(c.html(),10),f={action:"wpforms_templates_favorite",slug:i,favorite:o,nonce:wpforms_form_templates.nonce},d=g.templateList.get("slug",i)[0],u=d.values(),v=function(){n.find(".fa-heart-o").toggleClass("wpforms-hidden",u.favorite),n.find(".fa-heart").toggleClass("wpforms-hidden",!u.favorite)};w.post(wpforms_form_templates.ajaxurl,f,function(e){e.success||(o?t:a)()}),(o?a:t)()},maybeHideFavoritesCategory:function(){var e=w(".wpforms-setup-templates-categories"),t=e.find("[data-category='favorites']"),a=parseInt(t.find("span").html(),10);t.toggleClass("wpforms-hidden",!a),t.hasClass("active")&&(a?t:e.find("[data-category='all']")).trigger("click")},searchTemplate:function(e){h.performSearch(w(this).val()),h.showUpgradeBanner()},performSearch(e){e=g.templateList.search(e);w(".wpforms-templates-no-results").toggle(!e.length)},selectSubCategory(e){e.preventDefault();var e=w(this),t=e.closest("ul").find(".active");const a=e.data("subcategory"),s=e.parents("li").data("category");var o=w("#wpforms-setup-template-search").val();t.removeClass("active"),e.addClass("active"),g.templateList.filter(function(e){return"all"===s||-1<e.values().categories.split(",").indexOf(s)&&-1<e.values().subcategories.split(",").indexOf(a)}),""!==o&&h.performSearch(o),h.showUpgradeBanner()},selectCategory(e){e.preventDefault();const t=w(this).parent(),a=t.closest("ul").find(".active"),s=t.data("category"),o=w("#wpforms-setup-template-search").val();a.removeClass("active"),t.addClass("active"),g.templateList.filter(function(e){return"available"===s?e.values()["has-access"]:"favorites"===s?e.values().favorite:"all"===s||-1<e.values().categories.split(",").indexOf(s)}),""!==o&&h.performSearch(o),h.showUpgradeBanner()},selectTemplateCancel:function(){var e=w("#wpforms-setup-templates-list").find(".wpforms-template.active"),t=e.find(".wpforms-template-select");e.removeClass("active"),t.html(t.data("labelOriginal"))},showUpgradeBanner:function(){var e,t;w("#tmpl-wpforms-templates-upgrade-banner").length&&(e=wp.template("wpforms-templates-upgrade-banner"))&&(5<(t=w("#wpforms-setup-templates-list .wpforms-template")).length?t.eq(5):t.last()).after(e())},selectTemplateProcess:function(e,t,a,s){a.data("addons")?h.addonsModal(e,t,a,s):s(e,t)},addonsModal:function(e,t,a,s){var o=a.data("template-name-raw"),n=a.data("addons-names"),a=a.data("addons").split(",");let r=1<a.length?wpforms_form_templates.template_addons_prompt:wpforms_form_templates.template_addon_prompt;r=r.replace(/%template%/g,o).replace(/%addons%/g,n),a.length&&(wpforms_form_templates.can_install_addons?h.userCanInstallAddonsModal(e,t,a,r,s):h.userCannotInstallAddonsModal(r))},userCanInstallAddonsModal:function(e,t,a,s,o){w.confirm({title:wpforms_form_templates.heads_up,content:s,icon:"fa fa-exclamation-circle",type:"orange",buttons:{confirm:{text:wpforms_form_templates.install_confirm,btnClass:"btn-confirm",keys:["enter"],action:function(){return this.$$confirm.prop("disabled",!0).html('<i class="wpforms-loading-spinner wpforms-loading-white wpforms-loading-inline"></i>'+wpforms_form_templates.activating),this.$$cancel.prop("disabled",!0),h.installActivateAddons(a,this,e,t,o),!1}},cancel:{text:wpforms_form_templates.cancel,action:function(){WPFormsFormTemplates.selectTemplateCancel()}}}})},userCannotInstallAddonsModal:function(e){w.alert({title:wpforms_form_templates.heads_up,content:e,icon:"fa fa-exclamation-circle",type:"orange",buttons:{ok:{text:wpforms_form_templates.ok,btnClass:"btn-confirm",keys:["enter"],action:function(){WPFormsFormTemplates.selectTemplateCancel()}}}})},installActivateAddons:function(e,t,a,s,o){const n=[],r=[];let l=!1;e.forEach(function(t){l="function"!=typeof l.done?h.installActivateAddonAjax(t):l.done(function(e){return n.push(e),h.installActivateAddonAjax(t)}).fail(function(e){r.push(e)})}),l.done(function(e){n.push(e)}).fail(function(e){r.push(e)}).always(function(){t.close(),0<n.length&&wpf.listPluck(n,"success").every(Boolean)&&0===r.length?o(a,s):h.installActivateAddonsError(a,s,o)})},installActivateAddonsError:function(e,t,a){w.confirm({title:wpforms_form_templates.heads_up,content:wpforms_form_templates.template_addons_error,icon:"fa fa-exclamation-circle",type:"orange",buttons:{confirm:{text:wpforms_form_templates.use_template,btnClass:"btn-confirm",keys:["enter"],action:function(){a(e,t)}},cancel:{text:wpforms_form_templates.cancel,action:function(){h.selectTemplateCancel()}}}})},installActivateAddonAjax:function(e){var t=wpforms_addons[e],a=new w.Deferred;return!t||["activate","install"].indexOf(t.action)<0?(a.resolve(!1),a.promise()):w.post(wpforms_form_templates.ajaxurl,{action:"wpforms_"+t.action+"_addon",nonce:wpforms_form_templates.admin_nonce,plugin:"activate"===t.action?e+"/"+e+".php":t.url})}};return h}((document,window),jQuery);WPFormsFormTemplates.init();